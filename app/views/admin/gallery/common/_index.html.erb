<div class="admin-pictures">
  <ul>
    <% @pictures.each do |picture| %>
      <li id="picture-<%= picture.id %>">
        <a href="<%= picture.resource.url %>" class="fancybox" rel="gallery1">
          <img src="<%= picture.resource.small.url %>" />
          <span class="thumb_overlay"></span>
        </a>
        <div class='picture-operation'>
          <% if picture.sort_id.present? %>
            当前图片是首页<%= @category %>第<%= picture.sort_id %>张
          <% else %>
            <span class='js-sort cursor-pointer' data-id='<%= picture.id %>'>置顶</span>
          <% end %>
          <span><%= link_to '删除', 'javascript:void(0)', class: 'js-delete-picture', data: {id: picture.id} %></span>
        </div>
      </li>
    <% end %>
  </ul>
</div>
<div class='paginate'>
  <%= will_paginate @pictures %>
</div>

<script type="text/javascript">
  $(function() {
    $('.fancybox').fancybox();
    $(document).on('click', '.js-sort', editGallery);
    $(document).on('click', '.js-delete-picture', deletePicture);
  });

  function editGallery() {
    insertFloatWindow('<%= j render "admin/gallery/common/to_top" %>');
    $('#js-update-gallery').data('id', $(this).data('id'));
  }

  function deletePicture() {
    var self = $(this);
    swal({
     title: "您确定要删除吗？",
     type: "warning",
     showCancelButton: true,
     closeOnConfirm: false,
     confirmButtonText: "是的，强行删除",
     confirmButtonColor: "#ec6c62"
     }, function() {
       $.ajax({
         url: "/ajax/pictures/"+ self.data('id'),
         type: "DELETE",
         dataType: 'script',
         function(){}
       })
     });
  }

</script>
