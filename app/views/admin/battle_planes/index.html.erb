<div class="battle-planes">
  <ul>
    <% @planes.each do |plane| %>
      <li id='js-battleplane-<%= plane.id %>' data-id='<%= plane.id %>'>
        <h2><%= plane.title %></h2>
        <a href="javascript:void(0)" class='js-show-operations'><i class="fa fa-pencil"></i></a>
        <a href="javascript:void(0)" class='js-delete'><i class="fa fa-remove"></i></a>
        <p><%= plane.content %></p>
        <% if plane.sort_id.present? %>
          <span>当前战机简介是首页第<%= plane.sort_id %>篇</span>
        <% end %>
      </li>
    <% end %>
  </ul>
</div>
<div id='operate-wrap'>
</div>
<input type="hidden" id='battleplane-id'>

<script type="text/javascript">
  $(function() {
    $(document).on('click', '#js-cancel', cancelOperate);
    $(document).on('click', '#js-edit', editBattlePlane);
    $(document).on('click', '#js-update', updateBattlePlane);
    $(document).on('click', '#js-edit-order', editBattlePlaneOrder);
    $(document).on('click', '#js-sort', sortBattlePlane);
    $(document).on('click', '.js-show-operations', showOperations);
    $(document).on('click', '.js-delete', deletePlane);
  });

  function showOperations() {
    $('#operate-wrap').html('<%= j render "operations" %>');
    $('#battleplane-id').val($(this).parent().data('id'));
  }

  function cancelOperate() {
    $('#operate-wrap').html('');
  }

  function editBattlePlane() {
    $('#operate-wrap').html('<%= j render "edit" %>');
    var battleplaneLi = $('#js-battleplane-'+$('#battleplane-id').val());
    $('#js-title').val(battleplaneLi.find('h2').html());
    $('#js-content').val(battleplaneLi.find('p').html());
  }

  function updateBattlePlane() {
    $('#battleplaneForm').attr('action', '/ajax/battle_planes/'+ $('#battleplane-id').val()).submit();
  }

  function editBattlePlaneOrder() {
    $('#operate-wrap').html('<%= j render "sort" %>');
  }

  function sortBattlePlane() {
    $('#sortForm').attr('action', '/admin/battle_planes/'+$('#battleplane-id').val()).submit();
  }

  function deletePlane() {
    var self = $(this);
    swal({
     title: "您确定要删除吗？",
     type: "warning",
     showCancelButton: true,
     closeOnConfirm: false,
     confirmButtonText: "是的，强行删除",
     confirmButtonColor: "#ec6c62"
     }, function() {
       $.ajax({
         url: "/ajax/battle_planes/"+ self.parent().data('id'),
         type: "DELETE",
         dataType: 'script',
         success: function(){}
       })
     });
  }
</script>
